<html>
    <head>
        <title> Tests </title>
        <link rel="stylesheet" href="./node_modules/mocha/mocha.css" />
    </head>
    <body>
        <div id="mocha"></div>
        
        <script src="./app/lib/closure-library/closure/goog/base.js"></script>
        <script src="./app/lib/jquery/jquery.min.js"></script>

        <script>  goog.basePath = '/app/'; </script>
        <script src="./app/deps.js"></script>

        <script src="./node_modules/mocha/mocha.js"></script>
        <script src="./node_modules/chai/chai.js"></script>

        <script>
            mocha.ui('bdd');
            mocha.reporter('html');
            
            var should = chai.should();
            
            var testRunner = window.mochaPhantomJS ? mochaPhantomJS.run : mocha.run;
        </script>
        
        <script type="text/javascript">
            $(document).on('tests-loaded', function() {
                console.log('Tests loaded, starting mocha.');

                window.testRunner();
            });

            $.getScript("./tests/tests.js", function(data) {
                var scriptQueue = JSON.parse(data);

                var pendingScriptCount = scriptQueue.length;

                console.log(pendingScriptCount + " tests to load.");

                var decrementPendingScriptCount = function() {
                    pendingScriptCount--;

                    if(pendingScriptCount === 0) {
                        $(document).trigger('tests-loaded');
                    } 
                }

                for(var script in scriptQueue) {
                    $.getScript(scriptQueue[script], function(data) {
                        console.log('Loaded ' + scriptQueue[script]);

                        decrementPendingScriptCount();
                    });
                }
            });
        </script>
    </body>
</html>